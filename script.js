/** Shared site script (v18) */
const themeToggle=document.getElementById('themeToggle');const mobileThemeToggle=document.getElementById('mobileThemeToggle');const storedTheme=localStorage.getItem('theme');if(storedTheme)document.documentElement.setAttribute('data-theme',storedTheme);function setTheme(t){document.documentElement.setAttribute('data-theme',t),localStorage.setItem('theme',t),themeToggle&&(themeToggle.textContent='dark'===t?'☀️':'🌙'),mobileThemeToggle&&(mobileThemeToggle.textContent='dark'===t?'☀️':'🌙')}!function(){const e='dark'===document.documentElement.getAttribute('data-theme')?'dark':'light';themeToggle&&(themeToggle.textContent='dark'===e?'☀️':'🌙',themeToggle.addEventListener('click',(()=>setTheme('dark'===document.documentElement.getAttribute('data-theme')?'light':'dark')))),mobileThemeToggle&&(mobileThemeToggle.textContent='dark'===e?'☀️':'🌙',mobileThemeToggle.addEventListener('click',(()=>setTheme('dark'===document.documentElement.getAttribute('data-theme')?'light':'dark'))))}();
function el(t,e={},n=[]){const o=document.createElement(t);return Object.entries(e).forEach((([t,e])=>{'class'===t?o.className=e:'html'===t?o.innerHTML=e:o.setAttribute(t,e)})),(Array.isArray(n)?n:[n]).filter(Boolean).forEach((t=>{'string'==typeof t?o.appendChild(document.createTextNode(t)):o.appendChild(t)})),o}function renderSection(t,e){const n=el('section',{id:t});return n.appendChild(el('h2',{},e)),n}
function renderResume(data){const root=document.getElementById('contentRoot');if(!root)return;root.innerHTML='';const s=renderSection('summary','Summary');s.appendChild(el('p',{},data.summary||'')),root.appendChild(s);const e=renderSection('experience','Experience');(data.experience||[]).forEach((t=>{const n=el('h3',{},`${t.role||''} — ${t.company||''}`.trim()),o=el('p',{},`${t.start||''} — ${t.end||''}${t.location?' · '+t.location:''}`),i=el('ul');(t.bullets||[]).forEach((t=>i.appendChild(el('li',{},t)))),e.appendChild(n),e.appendChild(o),e.appendChild(i)})),root.appendChild(e);const i=renderSection('skills','Skills & Strengths'),l=el('div',{class:'pill-container'});(data.skills||[]).forEach((t=>l.appendChild(el('span',{class:'pill'},t)))),i.appendChild(l),root.appendChild(i);const a=renderSection('education','Education & Certifications');(data.education||[]).forEach((t=>{if(a.appendChild(el('p',{class:'edu-title'},t.title||'')),t.bullets&&t.bullets.length){const e=el('ul');t.bullets.forEach((t=>e.appendChild(el('li',{},t)))),a.appendChild(e)}})),root.appendChild(a);const r=renderSection('hobbies','Hobbies & Interests'),c=el('div',{class:'pill-container'});(data.hobbies||[]).forEach((t=>c.appendChild(el('span',{class:'pill'},t)))),r.appendChild(c),root.appendChild(r);const d=data.contact||{},p=(d.email||'').trim(),m=(d.phone||'').trim(),u=m.replace(/[^\d]/g,''),h=d.linkedin||'#',g=d.resumeFile||'assets/JakobDeGazio - Resume.pdf';[document.getElementById('contactInfoMobile'),document.getElementById('contactInfoDesktop')].forEach((t=>{t&&(t.innerHTML=p||m?`${m?`<p><strong>Phone:</strong> <a rel="nofollow" href="tel:${u}">${m}</a></p>`:''}${p?`<p><strong>Email:</strong> <a rel="nofollow" href="mailto:${p}">${p}</a></p>`:''}`:'')}));const y=document.getElementById('dlDesktop'),f=document.getElementById('dlMobile');y&&(y.href=g),f&&(f.href=g);const v=document.getElementById('lnDesktop'),b=document.getElementById('lnMobile');v&&(v.href=h),b&&(b.href=h);setupReveal(),setupScrollSpy(),enhanceContactBlocks(),wireProfileClicks()}
function enhanceContactBlocks(){document.querySelectorAll('.contact-block').forEach((t=>{const e=t.querySelector('.contact-toggle'),n=t.querySelector('.contact-info');e&&n&&e.addEventListener('click',(()=>{n.classList.remove('is-hidden'),n.classList.add('revealed'),e.setAttribute('aria-expanded','true'),e.style.display='none'}),{once:!0})}))}
function buildNavFromSections(){const t=document.getElementById('navRight');t&&t.querySelectorAll('a[data-dynamic="1"]').forEach((t=>t.remove()))}
function setupReveal(){const t=document.querySelectorAll('main section');if(!t.length)return;const e=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&t.target.classList.add('show')}))}),{threshold:.1});t.forEach((t=>e.observe(t)))}
function setupScrollSpy(){const t=Array.from(document.querySelectorAll('.nav-right a')),e=Array.from(document.querySelectorAll('main section'));if(!t.length||!e.length)return;const n=a=>((a.getAttribute('href')||'').replace('#','')),o=new Map(t.map((t=>[n(t),t]))),c=t=>{t&&(t.forEach((t=>t.classList.remove('active'))),o.get(t)||null)?.classList.add('active')};function r(){const t=e[0];if(window.scrollY<=t.offsetTop+5){c(t.id);return}const n=window.innerHeight+window.scrollY,o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);if(n>=o-2){c(e[e.length-1].id);return}const r=window.scrollY+window.innerHeight/2;let l=t.id;for(const n of e){const t=n.offsetTop,o=t+n.offsetHeight;if(r>=t&&r<o){l=n.id;break}}c(l)}window.addEventListener('scroll',r,{passive:!0}),window.addEventListener('resize',r),document.addEventListener('DOMContentLoaded',r),r(),t.forEach((t=>{t.addEventListener('click',(()=>{const e=n(t);c(e),setTimeout(r,900)}))}))}
const printBtn=document.getElementById('printBtn');printBtn&&printBtn.addEventListener('click',(()=>window.print()));
const expandBtn=document.getElementById('expandBtn'),mobileProfile=document.getElementById('mobileProfile');let lastY=window.scrollY,fadeTimer=null;if(expandBtn&&mobileProfile){expandBtn.addEventListener('click',(()=>{const t=mobileProfile.classList.toggle('expanded');expandBtn.setAttribute('aria-expanded',String(t)),t||expandBtn.classList.remove('faded')})),window.addEventListener('scroll',(()=>{if(mobileProfile.classList.contains('expanded'))return;const t=window.scrollY,e=t>lastY;lastY=t,e?expandBtn.classList.add('faded'):expandBtn.classList.remove('faded'),clearTimeout(fadeTimer),fadeTimer=setTimeout((()=>expandBtn.classList.remove('faded')),400)}),{passive:!0}),window.addEventListener('touchstart',(()=>{expandBtn.classList.remove('faded')}),{passive:!0})}
const imageModal=document.getElementById('imageModal'),modalImage=document.getElementById('modalImage'),modalClose=document.getElementById('modalClose');function openModal(e){imageModal&&modalImage&&(modalImage.src=e,imageModal.classList.remove('hidden'),document.body.style.overflow='hidden')}function closeModal(){imageModal&&(imageModal.classList.add('hidden'),document.body.style.overflow='')}function wireProfileClicks(){document.querySelectorAll('.profile-photo').forEach((e=>{e.addEventListener('click',(()=>{window.matchMedia('(min-width: 901px)').matches&&openModal(e.getAttribute('src'))}))}))}imageModal&&imageModal.addEventListener('click',(t=>{'true'===t.target.dataset.close&&closeModal()})),modalClose&&modalClose.addEventListener('click',closeModal),document.addEventListener('keydown',(t=>{'Escape'===t.key&&closeModal()}));
async function fetchResume(){try{const t='assets/resume.json?v='+Date.now(),e=await fetch(t,{cache:'no-store'});if(!e.ok)throw new Error('HTTP '+e.status);const n=await e.json();renderResume(n)}catch(t){console.error('Failed to fetch assets/resume.json',t);const e=document.getElementById('contentRoot');e&&(e.innerHTML='<section class="show"><h2>Error</h2><p>Could not load <code>assets/resume.json</code>.</p></section>')}}
document.addEventListener('DOMContentLoaded',(()=>{document.getElementById('contentRoot')&&!window.SKIP_AUTO_LOAD&&fetchResume()}));
